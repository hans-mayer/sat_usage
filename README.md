### graph to show available satellites over 24 hours

for UNIX like systems

ksh scripts using gawk, gnuplot and gnuplot-x11

to use this script there are some prerequisites necessary. first of all one needs a GPS receiver with a serial interface. over this serial interface the NMEA information is sent to a Linux server. in my case i am using a GPS module from M0UPU with a small GPS antenna, a so called GPS mouse. as Linux box I am using a Banana PI M1. the serial interface is taken from GPIO module. additional you need the "gpsd" package. this is available at http://www.catb.org/gpsd/


##  sat_usage_ksh

    show number of satellites as graph - v 2016 04 08
    usage: sat_usage_ksh [ -c COUNT ] [ -f IMG ] FILE
       COUNT >= 1
       -f IMG      - output to file - IMG can be jpeg, png, ...

### examples

#### sat_usage_ksh -c 32 -f png  /var/adm/nmea_2016_096_log

![](img/plot_2016096_c32.png)

the image above shows in the first line inside the header name and IP address of the host running this script. next one can see the name of the log-file and the value of argument '-c'. this is the number of entries taken for an average calculation. <br>
in the second line one can see the minimum was 5 satellites for a period of 110 seconds and maximum 17 satellites for a period of 20 seconds. the average number of visible satellites is 8.4

below one can see the statistics for the same day but without option '-c'. therefore the counter is 1 and you can see for each second one marker. but a value of 32 gives in most cases better results as above.

#### sat_usage_ksh -f png  /var/adm/nmea_2016_096_log

![](img/plot_2016096_c1.png)

##  nmea_log_ksh

this script reads via "gpspipe" GPS information generated by "gpsd" and generates a file "/var/adm/nmea_YYYY_DDD_log". this file has 3 columns: timestamp1 timestamp2 number_of_satellites <br>
timestamp1 has format HHMMSS, timestamp2 are the seconds of the day

##  cron job

once at 00:00 UTC this script "nmea_log_ksh" should be terminated and a new one should be started. to do this is very simple. ( script "new_nmea_ksh" )

    pkill gpspipe
    nmea_log_ksh &

to execute a script at 00:00 UTC i run the following at midnight

<pre>
TIMEDIFF=`date '+%z' | awk '{ print ( $1 / 100 ) }'`
at now + $TIMEDIFF hours 2> /dev/null << foe
new_nmea_ksh
# and do some other scripts, for example create an image file and send per e-mail
foe
</pre>

i am quite sure this script above will only work for locations east of Greenwich.

this is part of a NTP stratum 1 server. additional scripts for NTP you can find at https://github.com/hans-mayer/ntpgraph


## external link

If you are running a NTP server you may be interested in these scripts I wrote:

https://github.com/hans-mayer/ntpgraph
